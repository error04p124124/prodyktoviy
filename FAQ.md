# FAQ - Вопросы для защиты проекта

## Общие вопросы о проекте

### Что представляет собой ваш проект?
Это веб-приложение для управления продуктовым магазином "На Просторной". Система автоматизирует учет товаров, продажи, инвентаризацию, списания и формирование отчетов.

### Какую проблему решает ваш проект?
Проект решает проблему учета товаров в розничном магазине: отслеживание остатков, контроль сроков годности, автоматический расчет продаж, формирование отчетности для руководства.

### Какие основные функции реализованы?
1. **Управление товарами**: добавление, редактирование, контроль остатков
2. **Система продаж**: оформление продаж с печатью чеков
3. **Инвентаризация**: проверка фактических остатков с группировкой по датам
4. **Списания**: учет испорченных товаров с указанием причин
5. **Поставки**: прием товара с печатью товарных накладных
6. **Отчетность**: статистика продаж, популярные товары, динамика по дням/месяцам
7. **Ролевая система**: разграничение прав для директора, менеджера и кассира

## Технологии

### Какие технологии использованы в проекте?

**Backend:**
- Python 3.12
- Django 4.2.7 (веб-фреймворк)
- SQLite (база данных)

**Frontend:**
- HTML5, CSS3
- JavaScript (ES6+)
- Chart.js (для графиков и диаграмм)
- Bootstrap 5 (для адаптивной верстки)

**Дополнительно:**
- Django ORM для работы с БД
- Django Templates для рендеринга страниц
- AJAX для асинхронных запросов

### Почему выбрали Django?
Django - это full-stack фреймворк, который предоставляет из коробки:
- ORM для работы с БД без SQL
- Систему аутентификации и авторизации
- Админ-панель для управления данными
- Защиту от CSRF, XSS, SQL-инъекций
- Удобную систему маршрутизации (URLs)
- Template engine для HTML-шаблонов

### Почему SQLite, а не PostgreSQL/MySQL?
SQLite подходит для учебного проекта и небольших магазинов:
- Не требует установки отдельного сервера БД
- Вся БД в одном файле - легко переносить
- Достаточно быстрая для малого/среднего объема данных
- Простое развертывание

Для масштабирования легко перейти на PostgreSQL благодаря Django ORM.

## Архитектура проекта

### Какая архитектура используется?
Проект использует **MVC/MTV** архитектуру Django:
- **Model** (модели) - структура данных, работа с БД
- **Template** (шаблоны) - представление, HTML
- **View** (представления) - бизнес-логика, обработка запросов

### Какая структура приложений?
```
grocery_store/          # Главное приложение (настройки)
├── settings.py         # Конфигурация проекта
├── urls.py             # Главный роутинг
└── wsgi.py             # WSGI интерфейс

accounts/               # Приложение пользователей
├── models.py           # CustomUser с ролями
├── views.py            # Вход/выход
└── management/         # Команда создания пользователей

products/               # Приложение товаров
├── models.py           # Category, Product, Supply, SupplyItem
├── views.py            # CRUD товаров, категорий, поставок
└── templates/          # HTML шаблоны

sales/                  # Приложение продаж
├── models.py           # Sale, SaleItem
├── views.py            # Создание продаж, печать чеков
└── templates/          # HTML чеки

inventory/              # Приложение инвентаризации
├── models.py           # InventoryCheck
├── views.py            # Проведение инвентаризации
└── templates/          # Список проверок

writeoffs/              # Приложение списаний
├── models.py           # WriteOff
├── views.py            # Учет списаний
└── templates/          # Формы списаний

reports/                # Приложение отчетности
├── views.py            # API для статистики
└── templates/          # Дашборды с графиками
```

### Как организована база данных?
**Основные модели:**

1. **CustomUser** - пользователи с ролями (director, manager, cashier)
2. **Category** - категории товаров (название)
3. **Product** - товары (название, штрихкод, цена, количество, срок годности, категория)
4. **Supply** - поставки (поставщик, дата, общая сумма)
5. **SupplyItem** - позиции в поставке (товар, количество, цена)
6. **Sale** - продажи (кассир, дата, сумма)
7. **SaleItem** - позиции в продаже (товар, количество, цена)
8. **InventoryCheck** - инвентаризация (товар, ожидаемое/фактическое количество, session_id)
9. **WriteOff** - списания (товар, количество, причина, создатель)

**Связи:**
- Category → Product (один ко многим)
- CustomUser → Sale (один ко многим, кассир)
- Supply → SupplyItem (один ко многим)
- Sale → SaleItem (один ко многим)
- Product связан со всеми операциями через ForeignKey

## Реализация функционала

### Как работает система ролей?
**3 роли с разными правами:**

1. **Директор (director)**:
   - Суперпользователь (is_superuser=True, is_staff=True)
   - Доступ ко всем функциям
   - Управление пользователями через админ-панель

2. **Менеджер (manager)**:
   - Персонал (is_staff=True)
   - Управление товарами, поставками, инвентаризацией
   - Доступ к отчетам и админ-панели

3. **Кассир (cashier)**:
   - Обычный пользователь
   - Только создание продаж
   - Просмотр товаров

**Проверка в коде:**
```python
@login_required
@user_passes_test(lambda u: u.is_manager_or_director())
def product_create(request):
    # Только менеджер и директор
```

### Как реализована инвентаризация?
Инвентаризация группируется по дням через `session_id`:
- При создании инвентаризации `session_id = дата (YYYY-MM-DD)`
- Все проверки за один день имеют одинаковый `session_id`
- В списке инвентаризаций отображаются сгруппированные записи
- Можно сравнить ожидаемое и фактическое количество по категориям

**Пример кода:**
```python
def inventory_create(request):
    session_id = date.today().strftime('%Y-%m-%d')
    InventoryCheck.objects.create(
        product=product,
        expected_quantity=product.quantity,
        actual_quantity=actual_quantity,
        session_id=session_id
    )
```

### Как формируются отчеты?
Отчеты состоят из двух частей:

1. **Статистика** (плитки на странице):
   - Общая выручка за день/месяц/год
   - Количество продаж
   - Средний чек
   - Списания за периоды

2. **Детальные отчеты** (для печати):
   - API endpoint возвращает JSON с данными
   - JavaScript генерирует HTML-документ
   - Форматирование в стиле официального отчета
   - Открывается в новом окне для печати

**API endpoints:**
- `/reports/api/statistics/` - общая статистика
- `/reports/api/detailed-sales/` - детальный отчет по продажам
- `/reports/api/detailed-products/` - отчет по товарам
- `/reports/api/detailed-writeoffs/` - отчет по списаниям

### Как работает печать чеков и накладных?
**Чеки продаж:**
- Шаблон `receipt_template.html` с CSS для печати
- Формат 80мм (термопринтер)
- Содержит: товары, цены, сумму, дату, кассира
- Открывается в новом окне с автовызовом print()

**Товарные накладные:**
- Шаблон `supply_invoice.html` - формат A4
- Полная информация: поставщик, товары, цены, итого
- Блоки для подписей (поставщик/покупатель)
- Профессиональный дизайн с логотипом магазина

### Как контролируются сроки годности?
На странице товаров визуальная индикация:
- **Зеленый** - срок годности > 7 дней
- **Желтый** - срок годности 3-7 дней (предупреждение)
- **Красный** - срок годности < 3 дней (срочно списать)
- **Серый** - срок истек (требует удаления)

Система автоматически подсвечивает товары в зависимости от даты.

## Безопасность

### Какие меры безопасности реализованы?
1. **Аутентификация**: все страницы требуют входа (`@login_required`)
2. **Авторизация**: проверка прав доступа (`@user_passes_test`)
3. **CSRF защита**: Django автоматически защищает формы
4. **Хеширование паролей**: Django использует PBKDF2
5. **XSS защита**: автоматическое экранирование в шаблонах
6. **SQL инъекции**: использование ORM вместо raw SQL

### Как хранятся пароли?
Пароли хешируются через Django's `make_password()`:
- Алгоритм PBKDF2 с SHA256
- Уникальная соль для каждого пароля
- В БД хранится только хеш
- Невозможно восстановить исходный пароль

## Графики и визуализация

### Какие графики реализованы?
Используется библиотека **Chart.js**:

1. **Продажи по дням** (Line Chart) - динамика выручки за 30 дней
2. **Популярные товары** (Bar Chart) - топ-10 товаров по количеству продаж
3. **Продажи по категориям** (Pie Chart) - распределение выручки по категориям

**Обновление данных:**
- AJAX запросы к API каждые 30 секунд
- Автоматическая перерисовка графиков
- Отображение загрузчика во время запроса

## Развертывание и запуск

### Как запустить проект?
```bash
# 1. Клонировать/скачать проект
# 2. Создать виртуальное окружение
python -m venv venv
venv\Scripts\activate  # Windows

# 3. Установить зависимости
pip install django

# 4. Применить миграции
python manage.py migrate

# 5. Создать пользователей
python manage.py create_users

# 6. Запустить сервер
python manage.py runserver 8080

# 7. Открыть в браузере
http://127.0.0.1:8080/
```

### Как сбросить базу данных?
```bash
del db.sqlite3
python manage.py migrate
python manage.py create_users
```

## Возможные вопросы на защите

### Почему не использовали React/Vue?
Для учебного проекта Django Templates достаточно. Они:
- Проще в освоении
- Не требуют сборки (webpack, npm)
- Интегрированы с Django
- Для интерактивности добавлен JavaScript

Для SPA лучше подошли бы React/Vue, но это усложнило бы проект.

### Как масштабировать проект?
1. Перейти на PostgreSQL
2. Добавить Redis для кеширования
3. Разделить на микросервисы (API на Django REST Framework)
4. Вынести фронтенд в отдельное приложение (React)
5. Использовать Celery для фоновых задач
6. Настроить CDN для статики

### Какие улучшения можно добавить?
1. **Функциональные:**
   - Возврат товаров
   - Скидки и акции
   - Управление поставщиками
   - SMS/Email уведомления о сроках годности
   - Экспорт отчетов в Excel/PDF

2. **Технические:**
   - REST API для мобильного приложения
   - WebSocket для real-time обновлений
   - Тесты (unit, integration)
   - Docker для развертывания
   - CI/CD pipeline

3. **UI/UX:**
   - Адаптивный дизайн для мобильных
   - Темная тема
   - Быстрый поиск товаров
   - Автодополнение в формах

### Сколько времени заняла разработка?
*[Укажите реальное время, например: "Около 2-3 недель: неделя на проектирование и настройку Django, неделя на основной функционал, неделя на отчеты и доработки"]*

### Какие сложности возникли?
1. **Группировка инвентаризации** - сначала пытался группировать по товарам, но нужна была группировка по дням через session_id
2. **API для отчетов** - ошибки с именами полей (sold_by vs cashier, written_off_by vs created_by)
3. **Печать документов** - подбор правильных CSS стилей для разных форматов (A4, чек 80мм)
4. **Графики Chart.js** - настройка корректного отображения и обновления данных

### Тестировали ли проект?
*Ручное тестирование:*
- Создание/редактирование товаров
- Оформление продаж с разными товарами
- Проведение инвентаризации
- Генерация отчетов
- Печать документов
- Проверка ролевого доступа

*Автоматические тесты не написаны (можно добавить в будущем)*

## Статистика проекта

### Размер проекта
- **Приложений Django**: 6 (accounts, products, sales, inventory, writeoffs, reports)
- **Моделей БД**: 9
- **Views (представлений)**: ~30
- **URL маршрутов**: ~40
- **HTML шаблонов**: ~25
- **Строк кода**: ~3000-4000 (Python + HTML + JS + CSS)

### Демо-данные
После создания пользователей (`python manage.py create_users`) доступны:
- **director / director123** - полный доступ
- **manager / manager123** - управление товарами и отчеты
- **cashier / cashier123** - только продажи

## Полезные команды

```bash
# Создать суперпользователя вручную
python manage.py createsuperuser

# Открыть Django shell
python manage.py shell

# Создать новую миграцию после изменения models.py
python manage.py makemigrations

# Применить миграции
python manage.py migrate

# Собрать статические файлы (для production)
python manage.py collectstatic

# Запустить на другом порту
python manage.py runserver 3000

# Получить список всех команд
python manage.py help
```

## Контакты и поддержка

**Проект:** Система управления продуктовым магазином "На Просторной"  
**Автор:** *[Ваше имя]*  
**Учебное заведение:** *[Название]*  
**Год:** 2026

---

*Документация актуальна на январь 2026*
